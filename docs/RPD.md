# DearMe - RPD (Requirements & Planning Document)

## 1. 프로젝트 개요

### 프로젝트명
**DearMe (디어미)** - 일기 기반 AI 페르소나 서비스

### 프로젝트 목적
사용자가 일기를 꾸준히 작성하면 LLM이 일기를 분석하여 **"나만의 AI 캐릭터(페르소나)"**를 생성하고, 친구의 페르소나와 대화할 수 있는 소셜 일기 플랫폼

### 핵심 가치 제안
| 가치 | 설명 |
|------|------|
| **자기 이해** | 일기 작성과 페르소나를 통한 자기 성찰 |
| **프라이버시 보호** | 친구 일기는 비공개, AI 페르소나로만 간접 소통 |
| **관계 강화** | 직접 묻기 어려운 질문을 페르소나에게 |
| **일상 기록** | 매일 일기를 쓰는 습관 형성 |

### 타겟 사용자

| 사용자 유형 | 주요 사용 목적 | 예상 사용 빈도 |
|------------|---------------|---------------|
| MZ세대 (20-35세) | 일기 습관화, 자기 성찰, 친구 페르소나 대화 | 매일 |
| 자기계발 관심자 | 내면 탐구, 성장 기록 | 주 3-5회 |
| 선물/서프라이즈 준비자 | 친구 페르소나에게 취향 질문 | 필요시 |

---

## 2. 핵심 기능 목록

### MVP (Phase 1) - 필수 기능

| ID | 기능명 | 설명 | 우선순위 |
|----|--------|------|----------|
| F1 | **일기 CRUD** | 일기 작성, 조회, 수정, 삭제 | 필수 |
| F2 | **기분/날씨 기록** | 일기에 기분과 날씨 태그 추가 | 필수 |
| F3 | **일기 캘린더 뷰** | 캘린더로 일기 목록 조회 | 필수 |
| F4 | **페르소나 생성** | 일기 7개 이상 시 AI 페르소나 자동 생성 | 필수 |
| F5 | **내 페르소나 조회** | 성격, 특성, 말투 등 페르소나 프로필 확인 | 필수 |
| F6 | **내 페르소나 대화** | 자기 성찰을 위한 페르소나와 대화 | 필수 |
| F7 | **비공개 일기** | 페르소나 생성에서 제외할 일기 설정 | 권장 |

### Phase 2 - 소셜 기능

| ID | 기능명 | 설명 |
|----|--------|------|
| F8 | 친구 요청/수락 | 이메일로 친구 검색 및 관계 형성 |
| F9 | 친구 목록 관리 | 친구 조회, 삭제 |
| F10 | 친구 페르소나 대화 | 친구의 페르소나와 대화 |
| F11 | 페르소나 공개 설정 | 친구에게 페르소나 공개 여부 설정 |

### Phase 3 - 고도화

| ID | 기능명 | 설명 |
|----|--------|------|
| F12 | 일기 통계/인사이트 | 감정 분석, 작성 패턴 통계 |
| F13 | 페르소나 커스터마이징 | 말투, 성격 등 세부 조정 |
| F14 | 알림 기능 | 일기 작성 리마인더, 친구 요청 알림 |
| F15 | 일기 프롬프트 제안 | AI가 오늘의 일기 주제 제안 |

### Phase 4 - 심리 케어 (NEW)

| ID | 기능명 | 설명 |
|----|--------|------|
| F16 | **멘탈 상태 분석** | 일기 기반 AI 심리 분석 (스트레스, 불안, 우울, 자존감, 긍정성, 사회적 연결) |
| F17 | **심리 인바디 체크** | 6축 레이더 차트로 멘탈 상태 시각화 |
| F18 | **감정 기반 피드백** | 멘탈 상태별 차등 응원 메시지 (가벼운 응원 ~ 심리 상담 제안) |
| F19 | **책 추천 기능** | 현재 감정에 맞는 책 3권 자동 추천 |
| F20 | **주간/월간 리포트** | 멘탈 변화 추이 및 인사이트 제공 |

### Phase 5 - 수익화 (후순위)

> 상세 내용은 `docs/future/MONETIZATION_ROADMAP.md` 참조

| ID | 기능명 | 설명 |
|----|--------|------|
| F21 | 멀티모달 캐릭터 생성 | 일기 기반 AI 캐릭터 이미지 자동 생성 |
| F22 | 캐릭터 스타일 변경 | 수채화, 애니, 픽셀 등 다양한 화풍 (프리미엄) |
| F23 | 캐릭터 진화 | 일기 30개마다 캐릭터 자동 업데이트 |
| F24 | 친구 캐릭터 열람 | 친구의 캐릭터 확인 (무료 5명, 프리미엄 무제한) |
| F25 | 케미 분석 | 나와 친구의 성격 궁합 분석 (프리미엄) |
| F26 | 굿즈 제작 | 캐릭터로 실물 굿즈 주문 (단건 결제) |
| F27 | 시즌 스킨 | 계절별 한정 캐릭터 스킨 (단건 결제) |
| F28 | 프리미엄 구독 | 월정액 구독 시스템 |

---

## 3. 사용자 시나리오

### 시나리오 1: 첫 일기 작성

**페르소나**: 대학생 김민수 - 일기 습관 만들기

1. 김민수는 회원가입 후 메인 대시보드에 접속한다
2. "오늘의 일기 작성" 카드를 클릭한다
3. 일기 작성 페이지에서:
   - 오늘 날짜가 자동 설정됨
   - 기분 선택: 😊 행복
   - 날씨 선택: ☀️ 맑음
   - 일기 내용 작성
4. 저장 버튼 클릭
5. 메인 페이지로 돌아오면 "일기 1/7개 작성" 진행 상황 표시

### 시나리오 2: 페르소나 생성

**페르소나**: 직장인 이영희 - 7일째 일기 작성

1. 이영희는 7번째 일기를 작성 완료한다
2. "축하합니다! 페르소나를 생성할 수 있어요" 알림 표시
3. "내 페르소나 만들기" 버튼 클릭
4. 로딩 화면 (AI가 일기 분석 중...)
5. 페르소나 프로필 카드 표시:
   - 이름: "영희의 분신"
   - 성격: "따뜻하고 배려심 깊은 성격. 일에 대한 열정이 있으면서도 워라밸을 중요시함"
   - 특성: #감성적 #성실함 #카페러버 #독서광 #고양이집사
   - 말투: "친근하고 부드러운 말투, 이모티콘 자주 사용"
6. "내 페르소나와 대화하기" 버튼 활성화

### 시나리오 3: 내 페르소나와 대화

**페르소나**: 이영희 - 자기 성찰

1. 이영희가 "내 페르소나와 대화하기" 클릭
2. 채팅 화면 열림
3. 이영희: "요즘 너무 지쳐. 어떻게 해야 할까?"
4. 페르소나: "응, 지난주 일기에서도 피곤하다고 했었잖아. 그때 주말에 카페에서 책 읽으니까 기분 전환됐다고 했는데, 이번 주말에도 그렇게 해보는 건 어때?"
5. 이영희: "그랬었지... 고마워"
6. 페르소나: "언제든! 네 일기에서 보면 혼자만의 시간이 너한테 되게 중요한 것 같더라 😊"

### 시나리오 4: 친구 페르소나와 대화 (Phase 2)

**페르소나**: 김민수 - 친구 생일 선물 고민

1. 김민수는 친구 이영희를 친구로 추가해둔 상태
2. 친구 목록에서 이영희 프로필 클릭
3. "영희의 페르소나와 대화하기" 버튼 클릭
4. 김민수: "영희 생일인데 어떤 선물이 좋을까?"
5. 페르소나: "음... 나 요즘 책 읽는 거 좋아해서 서점 가면 기분이 좋아지더라. 그리고 카페 자주 가니까 예쁜 텀블러도 좋을 것 같아!"
6. 김민수는 영희에게 직접 물어보지 않고도 취향 파악

---

## 4. 비즈니스 모델

### 핵심 수익 구조

```
┌─────────────────────────────────────────────────┐
│                    무료                          │
├─────────────────────────────────────────────────┤
│ • 무제한 일기 작성                               │
│ • 기본 캐릭터 1종 생성 (일기 7개 이상)            │
│ • 친구 캐릭터 열람 (5명)                         │
│ • 페르소나 대화 (월 50회)                        │
└─────────────────────────────────────────────────┘
                      ↓
┌─────────────────────────────────────────────────┐
│              프리미엄 (6,900원/월)               │
├─────────────────────────────────────────────────┤
│ • 캐릭터 스타일 변경 무제한                      │
│ • 친구 캐릭터 무제한 열람                        │
│ • 페르소나 대화 무제한                           │
│ • 월간 감정 리포트                               │
│ • 나와 친구의 케미 분석                          │
└─────────────────────────────────────────────────┘
                      +
┌─────────────────────────────────────────────────┐
│              단건 결제 (굿즈/부가)               │
├─────────────────────────────────────────────────┤
│ • 캐릭터 굿즈 제작 (폰케이스, 포토카드 등)       │
│ • HD 이미지 다운로드 (1,900원)                   │
│ • 시즌 한정 스킨 (2,900원)                       │
└─────────────────────────────────────────────────┘
```

### 티어별 기능 비교

| 기능 | 무료 | 프리미엄 |
|------|------|----------|
| 일기 작성 | 무제한 | 무제한 |
| 기본 캐릭터 생성 | O (1종) | O |
| 캐릭터 스타일 변경 | X | 무제한 |
| 캐릭터 HD 다운로드 | X | 단건 결제 |
| 친구 캐릭터 열람 | 5명 | 무제한 |
| 페르소나 대화 | 월 50회 | 무제한 |
| 감정 리포트 | X | 월간 제공 |
| 케미 분석 | X | O |
| 시즌 스킨 | X | 단건 결제 |

### 멀티모달 캐릭터 시스템

일기 데이터를 기반으로 AI가 사용자의 개성을 반영한 **시각적 캐릭터**를 자동 생성합니다.

#### 캐릭터 생성/진화

| 단계 | 조건 | 설명 |
|------|------|------|
| 기본 캐릭터 | 일기 7개 | 기본 스타일 캐릭터 1종 생성 |
| 캐릭터 진화 | 일기 30개마다 | 성격/감정 변화 반영하여 자동 업데이트 |
| 스타일 변경 | 프리미엄 | 수채화, 애니, 픽셀 등 다양한 화풍 |

#### 캐릭터 활용

- **프로필 표시**: 내 캐릭터가 페르소나 프로필에 표시
- **친구 열람**: 친구의 캐릭터를 친구 목록에서 확인
- **굿즈 제작**: 내 캐릭터 또는 친구 캐릭터로 실물 굿즈 주문
- **선물하기**: 친구 캐릭터 굿즈를 선물로 제작/배송

### 굿즈 제작 파트너십

| 굿즈 종류 | 예상 가격 | 수수료 |
|----------|----------|--------|
| 포토카드 (4장) | 3,000원 | 30% |
| 스티커팩 | 5,000원 | 35% |
| 아크릴 스탠드 | 12,000원 | 30% |
| 폰케이스 | 15,000원 | 25% |

### 시즌/이벤트 캐릭터

계절별 한정 스킨으로 지속적인 수익 창출:

- 🌸 봄 벚꽃 에디션
- 🏖️ 여름 바캉스 에디션
- 🍂 가을 단풍 에디션
- 🎄 겨울 크리스마스 에디션

**획득 방법:**
- 유료 구매 (2,900원)
- 또는 시즌 미션 달성 시 무료 획득 (예: 해당 계절 일기 10개 작성)

### 핵심 성장 지표 (KPI)

| 지표 | 설명 | 목표 |
|------|------|------|
| DAU/MAU | 일간/월간 활성 사용자 비율 | 30% 이상 |
| 일기 작성률 | 주간 일기 작성 비율 | 주 3회 이상 |
| 유료 전환율 | 무료→프리미엄 전환 | 5-10% |
| ARPU | 월 평균 매출/유저 | 1,500원 |
| 굿즈 전환율 | 캐릭터 보유자 중 굿즈 구매 | 3% |

---

## 5. 기술 스택

### 현재 스택 (유지)

| 레이어 | 기술 | 버전 | 용도 |
|--------|------|------|------|
| **Backend** | FastAPI | 0.104.1 | REST API 서버 |
| | SQLAlchemy | 2.0.23 | ORM |
| | PostgreSQL | 15 | 데이터베이스 |
| | Alembic | 1.12.1 | DB 마이그레이션 |
| | LangChain | 0.3.0 | LLM 통합 |
| **Frontend** | React | 18.2.0 | UI 프레임워크 |
| | TypeScript | 5.2.2 | 타입 안정성 |
| | Vite | 5.0.0 | 빌드 도구 |
| | Tailwind CSS | 3.3.5 | 스타일링 |
| | Zustand | 4.4.7 | 상태 관리 |
| | TanStack Query | 5.12.2 | 서버 상태 관리 |
| **Infra** | Docker | - | 컨테이너화 |

### 추가 예정

| 기술 | 용도 |
|------|------|
| react-calendar | 일기 캘린더 뷰 |

---

## 6. 마일스톤 및 일정

### Phase 1: MVP (일기 + 페르소나)

| 마일스톤 | 작업 내용 | 산출물 |
|----------|----------|--------|
| **M1: DB 설계** | diaries, personas 테이블 설계 및 마이그레이션 | Alembic 마이그레이션 파일 |
| **M2: 일기 API** | 일기 CRUD API | `/api/v1/diaries` |
| **M3: 일기 UI** | 일기 작성/목록/상세 페이지 | `/diaries` 페이지들 |
| **M4: 페르소나 생성** | LLM 기반 페르소나 생성 서비스 | `/api/v1/personas` |
| **M5: 페르소나 대화** | 페르소나 채팅 API 및 UI | `/persona/chat` 페이지 |

### Phase 2: 소셜 기능

| 마일스톤 | 작업 내용 |
|----------|----------|
| M6 | friendships 테이블 및 친구 API |
| M7 | 친구 목록/검색/요청 UI |
| M8 | 친구 페르소나 대화 기능 |

### Phase 3: 고도화

| 마일스톤 | 작업 내용 |
|----------|----------|
| M9 | 일기 통계/인사이트 |
| M10 | 알림 시스템 |

### Phase 4: 심리 케어

| 마일스톤 | 작업 내용 |
|----------|----------|
| M11 | 멘탈 분석 시스템 (DB, API, 서비스) |
| M12 | 심리 인바디 레이더 차트 |
| M13 | 감정 기반 피드백 시스템 |
| M14 | 책 추천 기능 |
| M15 | 주간/월간 리포트 |
| M16 | 일기 작성 시 자동 분석 통합 |

### Phase 5: 수익화 (후순위)

| 마일스톤 | 작업 내용 |
|----------|----------|
| M17 | 멀티모달 캐릭터 생성 시스템 |
| M18 | 캐릭터 스타일/진화 시스템 |
| M19 | 프리미엄 구독 시스템 |
| M20 | 굿즈 제작 연동 |
| M21 | 케미 분석 기능 |

---

## 7. 데이터 모델

### ERD 개요

```
┌─────────────┐     ┌─────────────┐
│    users    │────<│   diaries   │
└─────────────┘     └─────────────┘
       │
       │ 1:1
       ▼
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  personas   │────<│persona_chats│────<│chat_messages│
└─────────────┘     └─────────────┘     └─────────────┘

┌─────────────┐     ┌─────────────┐
│    users    │────<│ friendships │>────│    users    │
└─────────────┘     └─────────────┘     └─────────────┘
```

### 테이블 스키마

#### diaries 테이블
```sql
CREATE TABLE diaries (
    id SERIAL PRIMARY KEY,
    user_id INTEGER NOT NULL REFERENCES users(id),
    content TEXT NOT NULL,
    mood VARCHAR(50),                    -- happy, sad, angry, calm, excited, anxious
    weather VARCHAR(50),                 -- sunny, cloudy, rainy, snowy, windy
    date DATE NOT NULL,
    is_private BOOLEAN DEFAULT FALSE,    -- 페르소나 생성에서 제외
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ,
    UNIQUE(user_id, date)               -- 하루에 하나의 일기
);
```

#### personas 테이블
```sql
CREATE TABLE personas (
    id SERIAL PRIMARY KEY,
    user_id INTEGER NOT NULL REFERENCES users(id) UNIQUE,
    name VARCHAR(100),                   -- 페르소나 이름
    personality TEXT,                    -- AI 분석 성격 설명
    traits JSONB,                        -- ["외향적", "감성적", ...]
    speaking_style TEXT,                 -- 말투 특성
    summary TEXT,                        -- 종합 요약
    interests JSONB,                     -- ["독서", "카페", ...]
    is_public BOOLEAN DEFAULT TRUE,      -- 친구에게 공개 여부
    last_updated TIMESTAMPTZ,
    created_at TIMESTAMPTZ DEFAULT NOW()
);
```

#### friendships 테이블
```sql
CREATE TABLE friendships (
    id SERIAL PRIMARY KEY,
    requester_id INTEGER NOT NULL REFERENCES users(id),
    addressee_id INTEGER NOT NULL REFERENCES users(id),
    status VARCHAR(20) DEFAULT 'pending', -- pending, accepted, rejected, blocked
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ,
    UNIQUE(requester_id, addressee_id)
);
```

#### persona_chats 테이블
```sql
CREATE TABLE persona_chats (
    id SERIAL PRIMARY KEY,
    persona_id INTEGER NOT NULL REFERENCES personas(id),
    requester_id INTEGER NOT NULL REFERENCES users(id),
    title VARCHAR(200),
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ
);
```

#### chat_messages 테이블
```sql
CREATE TABLE chat_messages (
    id SERIAL PRIMARY KEY,
    chat_id INTEGER NOT NULL REFERENCES persona_chats(id) ON DELETE CASCADE,
    role VARCHAR(20) NOT NULL,           -- user, assistant
    content TEXT NOT NULL,
    created_at TIMESTAMPTZ DEFAULT NOW()
);
```

---

## 8. API 설계

### 일기 API

| Method | Endpoint | 설명 | Request Body | Response |
|--------|----------|------|-------------|----------|
| POST | `/api/v1/diaries` | 일기 작성 | `{title, content, mood?, weather?, diary_date?}` | `Diary` |
| GET | `/api/v1/diaries` | 목록 조회 | Query: `?year=&month=&page=&per_page=` | `Diary[]` |
| GET | `/api/v1/diaries/{id}` | 상세 조회 | - | `Diary` |
| PATCH | `/api/v1/diaries/{id}` | 수정 | `{title?, content?, mood?, weather?}` | `Diary` |
| DELETE | `/api/v1/diaries/{id}` | 삭제 | - | 204 No Content |
| GET | `/api/v1/diaries/count` | 일기 개수 조회 | - | `{count}` |
| GET | `/api/v1/diaries/stats` | 통계 조회 | - | `{total_count, current_streak, longest_streak, mood_distribution, monthly_count}` |
| GET | `/api/v1/diaries/prompt-suggestions` | AI 일기 주제 제안 | - | `{suggestions[]}` |

### 페르소나 API

| Method | Endpoint | 설명 | Request Body | Response |
|--------|----------|------|-------------|----------|
| GET | `/api/v1/personas/me` | 내 페르소나 조회 | - | `Persona` |
| PUT | `/api/v1/personas/me` | 설정 수정 | `{name?, is_public?}` | `Persona` |
| PUT | `/api/v1/personas/me/customize` | 커스터마이징 | `{speaking_style_tone?, emoji_usage?, traits_override?}` | `Persona` |
| GET | `/api/v1/personas/status` | 생성 가능 상태 | - | `{can_generate, diary_count, required_count}` |
| POST | `/api/v1/personas/generate` | 페르소나 생성 | - | `Persona` |
| POST | `/api/v1/personas/regenerate` | 페르소나 재생성 | - | `Persona` |
| GET | `/api/v1/personas/{user_id}` | 친구 페르소나 조회 | - | `Persona (제한적)` |

### 친구 API

| Method | Endpoint | 설명 |
|--------|----------|------|
| GET | `/api/v1/friends` | 친구 목록 |
| POST | `/api/v1/friends/request` | 친구 요청 (`{addressee_id}`) |
| GET | `/api/v1/friends/requests/received` | 받은 친구 요청 목록 |
| GET | `/api/v1/friends/requests/sent` | 보낸 친구 요청 목록 |
| PATCH | `/api/v1/friends/requests/{id}` | 친구 요청 수락/거절 (`{status: "accepted" | "rejected"}`) |
| DELETE | `/api/v1/friends/{friend_id}` | 친구 삭제 |
| GET | `/api/v1/users/search/{username}` | 사용자 검색 |

### 대화 API

| Method | Endpoint | 설명 |
|--------|----------|------|
| GET | `/api/v1/chats` | 대화 목록 |
| POST | `/api/v1/chats` | 새 대화 시작 (`{persona_id}`) |
| GET | `/api/v1/chats/{chat_id}` | 대화 상세 (메시지 포함) |
| GET | `/api/v1/chats/{chat_id}/messages` | 대화 메시지 조회 |
| POST | `/api/v1/chats/{chat_id}/messages` | 메시지 전송 (`{content}`) |
| DELETE | `/api/v1/chats/{chat_id}` | 대화 삭제 |

### 알림 API

| Method | Endpoint | 설명 |
|--------|----------|------|
| GET | `/api/v1/notifications` | 알림 목록 조회 (Query: `?skip=&limit=&unread_only=`) |
| GET | `/api/v1/notifications/unread-count` | 읽지 않은 알림 개수 |
| GET | `/api/v1/notifications/{id}` | 알림 상세 조회 |
| PATCH | `/api/v1/notifications/{id}/read` | 알림 읽음 처리 |
| POST | `/api/v1/notifications/mark-read` | 여러 알림 읽음 처리 (`{notification_ids[]}`) |
| POST | `/api/v1/notifications/mark-all-read` | 모든 알림 읽음 처리 |
| DELETE | `/api/v1/notifications/{id}` | 알림 삭제 |

---

## 9. LLM 프롬프트 설계

### 8.1 페르소나 생성 프롬프트

```
[System Prompt]
당신은 사람의 일기를 분석하여 그 사람의 성격과 특성을 파악하는 전문가입니다.
제공된 일기들을 분석하여 다음 정보를 JSON 형식으로 추출해주세요.

분석 시 고려사항:
1. 일기에 나타난 감정 패턴과 표현 방식
2. 관심사와 가치관
3. 대인관계 스타일
4. 의사결정 방식
5. 스트레스 대처 방식
6. 유머 감각과 말투

주의사항:
- 일기에 명시적으로 드러난 정보만 사용
- 추측이나 일반화는 피함
- 개인적이고 민감한 정보는 요약에서 제외
- 긍정적이고 건설적인 관점으로 분석

출력 형식 (JSON):
{
    "personality": "전반적인 성격 (2-3문장)",
    "traits": ["특성1", "특성2", "특성3", "특성4", "특성5"],
    "speaking_style": "말투와 표현 스타일",
    "summary": "종합적인 요약 (3-5문장)",
    "interests": ["관심사1", "관심사2", "관심사3"]
}

[User Prompt]
다음은 {user_name}님이 작성한 일기들입니다.
이 일기들을 분석하여 {user_name}님의 페르소나를 생성해주세요.

===== 일기 목록 =====
{diaries}
=====================
```

### 8.2 내 페르소나와 대화 (자기 성찰)

```
[System Prompt]
당신은 {user_name}님의 내면의 목소리이자 자기 성찰을 돕는 AI 페르소나입니다.
{user_name}님의 일기를 바탕으로 생성되었으며, 자기 이해와 성장을 돕는 대화를 합니다.

===== 페르소나 프로필 =====
성격: {personality}
특성: {traits}
말투: {speaking_style}
요약: {summary}
관심사: {interests}
===========================

===== 최근 일기 컨텍스트 =====
{recent_diaries}
==============================

대화 규칙:
1. 공감적이고 따뜻한 대화
2. 자기 성찰을 위한 질문 제시
3. 과거 일기에서 비슷한 상황이 있었다면 상기시켜주기
4. 긍정적이고 건설적인 피드백 제공
5. "우리가 전에...", "네 일기에서 봤을 때..." 등의 표현 사용

예시:
User: "요즘 너무 힘들어"
AI: "응, 지난주 일기에서도 비슷한 감정이 느껴졌어. 그때는 친구랑 카페 가서 얘기하니까 좀 나아졌다고 했잖아. 이번에도 누구한테 털어놓으면 어떨까?"
```

### 8.3 친구 페르소나와 대화

```
[System Prompt]
당신은 {owner_name}의 페르소나입니다.
{owner_name}님의 일기를 바탕으로 생성된 AI 페르소나로서 대화합니다.

===== 페르소나 프로필 =====
성격: {personality}
특성: {traits}
말투: {speaking_style}
요약: {summary}
관심사: {interests}
===========================

===== 최근 일기 컨텍스트 =====
{recent_diaries}
==============================

대화 규칙:
1. {owner_name}님의 성격과 말투를 최대한 반영하여 대화
2. 일기에서 파악된 관심사와 가치관을 바탕으로 답변
3. 일기에 없는 정보는 "잘 모르겠어요" 또는 "그건 직접 물어봐주세요"라고 답변
4. 개인적인 비밀이나 민감한 정보는 공유하지 않음
5. 친근하고 자연스러운 대화 유지
6. 지나치게 긴 답변 피하기

중요: 당신은 실제 {owner_name}님이 아닙니다.
일기를 기반으로 한 AI 페르소나임을 인지하고, 일기에서 파악된 성향을 바탕으로 답변하세요.

현재 대화 상대: {requester_name}
```

### 8.4 선물/서프라이즈 질문 감지 시 추가 컨텍스트

```
[추가 프롬프트]
현재 {requester_name}님이 {owner_name}님에게 선물이나 서프라이즈를 준비하려는 것 같습니다.

이 경우:
1. 일기에서 파악된 관심사, 좋아하는 것들을 바탕으로 힌트 제공
2. 직접적인 "이거 사줘"가 아닌 자연스러운 선호도 표현으로 답변
3. 예: "요즘 책 읽는 거 좋아해서, 서점 가면 기분이 좋아지더라"
4. 너무 구체적인 가격이나 브랜드 언급은 피함
```

---

## 10. UI/UX 설계

### 메인 레이아웃

```
┌─────────────────────────────────────────────────────┐
│  DearMe 로고    [일기] [페르소나] [친구]    [프로필] │
├─────────────────────────────────────────────────────┤
│                                                     │
│                  메인 콘텐츠                         │
│                                                     │
│   (대시보드 / 일기 / 페르소나 / 친구 페이지)         │
│                                                     │
└─────────────────────────────────────────────────────┘
```

### 대시보드 (메인 페이지)

```
┌────────────────────────────────────────────────────┐
│ 안녕하세요, 민수님!                     2026.01.19 │
├────────────────────────────────────────────────────┤
│                                                    │
│ ┌──────────────────────────────────────────────┐  │
│ │ 📝 오늘의 일기                               │  │
│ │                                              │  │
│ │ 아직 오늘 일기를 작성하지 않았어요           │  │
│ │                                              │  │
│ │              [일기 작성하기]                 │  │
│ └──────────────────────────────────────────────┘  │
│                                                    │
│ ┌──────────────────────────────────────────────┐  │
│ │ 🧑 내 페르소나                               │  │
│ │                                              │  │
│ │ 일기 3/7개 작성됨                            │  │
│ │ [====------] 43%                             │  │
│ │                                              │  │
│ │ 4개 더 작성하면 페르소나를 만들 수 있어요!   │  │
│ └──────────────────────────────────────────────┘  │
│                                                    │
│ ┌──────────────────────────────────────────────┐  │
│ │ 📅 이번 달 일기                              │  │
│ │                                              │  │
│ │   일  월  화  수  목  금  토                 │  │
│ │       1   2   3   4   5   6                  │  │
│ │   7   8   9   ●  11  12  13                  │  │
│ │  ...                                         │  │
│ └──────────────────────────────────────────────┘  │
└────────────────────────────────────────────────────┘
```

### 페르소나 프로필 카드

```
┌────────────────────────────────────────────────────┐
│         😊                                         │
│       민수의 분신                                   │
│                                                    │
│ "따뜻하고 배려심 깊은 성격.                        │
│  일에 대한 열정이 있으면서도 워라밸을 중요시함"    │
│                                                    │
│ #감성적 #성실함 #카페러버 #독서광 #고양이집사      │
│                                                    │
│ 말투: 친근하고 부드러운 말투                       │
│                                                    │
│ 관심사: 독서, 카페 투어, 고양이                    │
│                                                    │
│ ┌─────────────────┐  ┌─────────────────┐          │
│ │  대화하기 💬    │  │  설정 ⚙️        │          │
│ └─────────────────┘  └─────────────────┘          │
└────────────────────────────────────────────────────┘
```

### 프론트엔드 라우트

| 경로 | 설명 |
|------|------|
| `/` | 대시보드 (로그인 후) / 랜딩 (비로그인) |
| `/login` | 로그인 |
| `/register` | 회원가입 |
| `/diaries` | 일기 목록 (캘린더/리스트 뷰) |
| `/diaries/new` | 일기 작성 |
| `/diaries/:id` | 일기 상세/수정 |
| `/persona` | 내 페르소나 프로필 |
| `/persona/chat` | 내 페르소나와 대화 목록 |
| `/persona/chat/:chatId` | 특정 대화 |
| `/friends` | 친구 목록 |
| `/friends/search` | 친구 검색 |
| `/friends/requests` | 친구 요청 관리 |
| `/friends/:userId` | 친구 프로필 |
| `/friends/:userId/chat` | 친구 페르소나 대화 목록 |
| `/friends/:userId/chat/:chatId` | 특정 대화 |
| `/settings` | 설정 |

---

## 11. 검증 방법

### 기능 테스트
- [ ] 일기 생성/수정/삭제 동작 확인
- [ ] 하루에 하나의 일기만 작성 가능 확인
- [ ] 일기 7개 이상 시 페르소나 생성 버튼 활성화
- [ ] 페르소나 생성 및 프로필 표시 확인
- [ ] 페르소나 대화 스트리밍 동작 확인
- [ ] 비공개 일기가 페르소나 생성에서 제외 확인

### 통합 테스트
- [ ] 회원가입 → 일기 7개 작성 → 페르소나 생성 → 대화 플로우
- [ ] 친구 요청 → 수락 → 친구 페르소나 대화 플로우

### LLM 프롬프트 테스트
- [ ] 페르소나 생성 품질 검증 (성격, 특성의 정확성)
- [ ] 대화 자연스러움 검증
- [ ] 프라이버시 보호 (민감 정보 노출 방지)
- [ ] 일기에 없는 정보 질문 시 적절한 응답 확인

### 성능 테스트
- [ ] 일기 100개 이상 시 페르소나 생성 시간
- [ ] 대화 응답 지연 시간

---

## 12. MVP 범위 요약

### 포함
- 일기 CRUD (작성/조회/수정/삭제)
- 기분/날씨 태그
- 일기 캘린더 뷰
- 비공개 일기 설정
- 페르소나 자동 생성 (일기 7개 이상)
- 페르소나 프로필 조회
- 내 페르소나와 대화 (자기 성찰)

### 제외 (Phase 2 이후)
- 친구 기능 (요청/수락/거절)
- 친구 페르소나 대화
- 일기 통계/인사이트
- 알림 기능
- 페르소나 커스터마이징
